<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/cadastrocliente.css">
    <title>Cadastro Cliente</title>
</head>

<body>
    <nav class="container">
        <nav class="hero">
            <h2>Venha fazer negócios conosco!</h2>
            <img src="/imagens/pexels-tomfisk-9893729.jpg" alt="">
        </nav>
        <main>
           
            <form action="/cadastrocliente" method="POST">
                <nav class="logo">
                
                      </nav>
                                    <nav class="input-group">
                                        <input type="text" name="nome_cliente" placeholder="Nome Completo" required>
                                        <input type="text" name="cpf_cliente" placeholder="CPF" required>
                                </nav>
                                    <nav class="input-group">
                                        <input type="text" name="endereco_cliente" placeholder="Endereço" required>
                                        <select id="estado_cliente" name="estado_cliente">
                                            <label for="estado">Selecione o seu Estado:</label>
                                            <option value="São paulo">SP</option>
                                            <option value="Rio de Janeiro">RJ</option>
                                            <option value="Minas Gerais">MG</option>
                                            <option value="Espirito Santo">ES</option>
                                        </select>
                                        <nav class="radio-group">
                                        </nav>
                                </nav>
                                    <nav class="input-group">
                                        <input type="email" name="email_cliente" placeholder="E-mail" required>
                                        <input type="tel" id="telefone_cliente" name="contato_cliente" placeholder="Contato (00) 00000-0000" required>

                                    </nav>
                                    <nav class="input-group">
                                        <nav class="password-container">
                        
                                            <input type="password" id="password" placeholder="Senha" onfocus="showMessage()" onblur="hideMessage()" oninput="validatePassword()">
                                            <nav id="message" class="invalid">A senha deve ter no mínimo 8 caracteres.</nav>
                                                                               
                                           
                                        </nav>
                                        <nav class="password-container">
                                            <input type="password" id="senha_cliente" name="senha_cliente" placeholder="Confirme sua enha" required>
                               </nav>
                                        </nav>
                                        <button type="submit"><a href="/perfilcliente"></a>Criar Conta</button>
                                    </nav>
                                </form>
                            </main>
                        </nav>
                
                    </body>
                    <script>document.getElementById('cadastroForm').addEventListener('submit', async function(event) {
                        event.preventDefault();
                    
                        const formData = {
                            nome_cliente: document.getElementById('nome_cliente').value,
                            cpf_cliente: document.getElementById('cpf_cliente').value,
                            endereco_cliente: document.getElementById('endereco_cliente').value,
                            contato_cliente: document.getElementById('contato_cliente').value,
                            email_cliente: document.getElementById('email_cliente').value,
                            senha_cliente: document.getElementById('senha_cliente').value,
                            confirmar_senha_cliente: document.getElementById('confirmar_senha_cliente').value,
                            estado_cliente: document.getElementById('estado_cliente').value,
                        };
                    
                        document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
                    
                        let isValid = true;
                    
                        if (!formData.nome_cliente) {
                            showError('nome_cliente', 'Nome Completo é obrigatório.');
                            isValid = false;
                        }
                    
                        if (!formData.cpf_cliente || !/^\d{11}$/.test(formData.cpf_cliente)) {
                            showError('cpf_cliente', 'O CPF deve ter 11 dígitos e conter apenas números.');
                            isValid = false;
                        }
                    
                        if (!formData.endereco_cliente) {
                            showError('endereco_cliente', 'Endereço é obrigatório.');
                            isValid = false;
                        }
                    
                        if (!formData.email_cliente || !/\S+@\S+\.\S+/.test(formData.email_cliente)) {
                            showError('email_cliente', 'Email é obrigatório e deve ser válido.');
                            isValid = false;
                        }
                    
                        if (!formData.contato_cliente || !/^\d{10,15}$/.test(formData.contato_cliente)) {
                            showError('contato_cliente', 'O contato deve ter entre 10 e 15 dígitos e conter apenas números.');
                            isValid = false;
                        }
                    
                        if (!formData.senha_cliente || formData.senha_cliente.length < 8) {
                            showError('senha_cliente', 'A senha deve ter no mínimo 8 caracteres.');
                            isValid = false;
                        }
                    
                        if (formData.senha_cliente !== formData.confirmar_senha_cliente) {
                            showError('confirmar_senha_cliente', 'As senhas não coincidem.');
                            isValid = false;
                        }
                    
                        if (!isValid) return;
                    
                        try {
                            const response = await fetch('/cadastrocliente', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(formData)
                            });
                    
                            const result = await response.json();
                    
                            if (response.status === 200) {
                                document.getElementById('success-message').innerText = result.message;
                                document.getElementById('cadastroForm').reset();
                            } else {
                                result.errors.forEach(error => {
                                    showError(error.field, error.message);
                                });
                            }
                        } catch (error) {
                            console.error('Erro ao enviar o formulário:', error);
                        }
                    });
                    
                    function showError(field, message) {
                        const input = document.getElementById(field);
                        const errorElement = document.getElementById(`${field}_error`);
                        errorElement.innerText = message;
                        errorElement.style.display = 'block';
                    }</script>
                    </html>